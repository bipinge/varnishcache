varnishtest "VSL tags backend reuse/recycle"

server s1 {
	rxreq
	txresp
	rxreq
	txresp
} -start

varnish v1 -vcl+backend {} -start
varnish v1 -cliok "param.set debug +syncvsl"

client c1 {
	txreq
	rxresp
	expect resp.status == 200
	txreq -url /2
	rxresp
	expect resp.status == 200
} -run

logexpect l1 -v v1 -d 1 -g session {
	expect * *	Begin		^bereq
	expect * =	BackendOpen	"connect *.* 0$"
	expect * =	BackendClose	"s1 recycle *.* 0$"
	expect * *	BackendOpen	"reuse *.* 1$"
	expect * =	BackendClose	"s1 recycle *.* 1$"
} -run
